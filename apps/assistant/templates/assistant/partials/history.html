{# Chat history fragment for pagination #} {% for message in messages %}
<div
  class="flex {% if message.role == 'user' %}justify-end{% else %}justify-start{% endif %} mb-4"
>
  {% if message.role == 'user' %} {# User message #}
  <div
    class="bg-[#274B59] text-[#D0E5F2] rounded-lg px-4 py-3 max-w-xs lg:max-w-md"
  >
    <p class="text-sm">{{ message.content }}</p>
    <span class="text-xs text-[#D0E5F2] opacity-70 mt-1 block">
      {{ message.created_at|date:"H:i" }}
    </span>
  </div>
  {% else %} {# Assistant message #}
  <div class="flex gap-3">
    <div
      class="w-8 h-8 rounded-full bg-[#274B59] text-[#D0E5F2] flex items-center justify-center text-xs font-bold flex-shrink-0"
    >
      H
    </div>
    <div
      class="bg-[#122E40] text-[#D0E5F2] rounded-lg px-4 py-3 max-w-xs lg:max-w-md"
    >
      <p class="text-sm whitespace-pre-wrap">{{ message.content }}</p>
      <span class="text-xs text-[#D0E5F2] opacity-70 mt-2 block">
        {{ message.created_at|date:"H:i" }}
      </span>

      {# Citations if available #} {% if message.context_sources %}
      <div class="mt-3 pt-3 border-t border-[#274B59]">
        <p class="text-xs font-semibold mb-2">Fontes:</p>
        <ul class="text-xs space-y-1">
          {% for source in message.context_sources %}
          <li class="text-[#D0E5F2] opacity-80">
            {{ forloop.counter }}. {{ source.title }}
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}
</div>
{% empty %}
<div class="text-center text-[#D0E5F2] opacity-50 py-8">
  <p class="text-sm">Nenhuma mensagem no hist√≥rico</p>
</div>
{% endfor %}
