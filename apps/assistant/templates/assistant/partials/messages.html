{# Message fragments for HTMX injection #} {# User Message #}
<div class="flex justify-end mb-4" id="message-user-{{ user_timestamp }}">
  <div
    class="bg-[#274B59] text-[#D0E5F2] rounded-lg px-4 py-3 max-w-xs lg:max-w-md"
  >
    <p class="text-sm">{{ user_message }}</p>
    <span class="text-xs text-[#D0E5F2] opacity-70 mt-1 block"
      >{{ user_timestamp }}</span
    >
  </div>
</div>

{# Loading indicator (shown while processing) #}
<div id="chat-loading" class="htmx-indicator flex justify-start mb-4">
  <div
    class="bg-[#122E40] text-[#D0E5F2] rounded-lg px-4 py-3 flex items-center gap-2"
  >
    <div class="flex gap-1">
      <span
        class="h-2 w-2 bg-[#274B59] rounded-full animate-bounce"
        style="animation-delay: 0s"
      ></span>
      <span
        class="h-2 w-2 bg-[#274B59] rounded-full animate-bounce"
        style="animation-delay: 0.2s"
      ></span>
      <span
        class="h-2 w-2 bg-[#274B59] rounded-full animate-bounce"
        style="animation-delay: 0.4s"
      ></span>
    </div>
    <span class="text-xs">Helix está digitando...</span>
  </div>
</div>

{# Assistant Response #}
<div
  class="flex justify-start mb-6"
  id="message-assistant-{{ assistant_timestamp }}"
>
  <div class="flex gap-3">
    {# Helix Avatar #}
    <div
      class="w-8 h-8 rounded-full bg-[#274B59] text-[#D0E5F2] flex items-center justify-center text-xs font-bold flex-shrink-0"
    >
      H
    </div>

    {# Response Box #}
    <div
      class="bg-[#122E40] text-[#D0E5F2] rounded-lg px-4 py-3 max-w-xs lg:max-w-md"
    >
      <p class="text-sm whitespace-pre-wrap">{{ assistant_response }}</p>
      <span class="text-xs text-[#D0E5F2] opacity-70 mt-2 block"
        >{{ assistant_timestamp }}</span
      >

      {# Citations #} {% if citations %}
      <div class="mt-3 pt-3 border-t border-[#274B59]">
        <p class="text-xs font-semibold mb-2">Fontes consultadas:</p>
        <ul class="text-xs space-y-1">
          {% for citation in citations %}
          <li class="text-[#D0E5F2] opacity-80">
            <a href="#" class="hover:underline">
              {{ forloop.counter }}. {{ citation.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %} {# Status indicator #} {% if status != 'success' %}
      <div class="mt-2 text-xs bg-yellow-900 text-yellow-200 rounded p-1">
        ⚠️ Status: {{ status }}
      </div>
      {% endif %}
    </div>
  </div>
</div>
